<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Maintenance Log - Aquatic Nature Discovery</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .maintenance-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 80px;
        }

        .maintenance-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #0066cc;
        }

        .maintenance-header h2 {
            color: #0066cc;
            margin-bottom: 0.5rem;
        }

        .maintenance-controls {
            background-color: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .control-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 1rem;
        }

        .control-group label {
            font-weight: bold;
            color: #333;
            min-width: 120px;
        }

        .control-group input,
        .control-group select,
        .control-group textarea {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .control-button {
            background-color: #0066cc;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .control-button:hover {
            background-color: #0055b3;
        }

        .maintenance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .maintenance-card {
            background: white;
            border: 1px solid #e6e6e6;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .maintenance-card h3 {
            color: #0066cc;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-completed {
            background-color: #28a745;
        }

        .status-pending {
            background-color: #ffc107;
        }

        .status-urgent {
            background-color: #dc3545;
        }

        .maintenance-details {
            margin-bottom: 1rem;
        }

        .maintenance-details p {
            margin: 0.25rem 0;
            color: #666;
        }

        .maintenance-details strong {
            color: #333;
        }

        .priority-high {
            border-left: 4px solid #dc3545;
        }

        .priority-medium {
            border-left: 4px solid #ffc107;
        }

        .priority-low {
            border-left: 4px solid #28a745;
        }

        .login-required {
            text-align: center;
            padding: 3rem;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin: 2rem auto;
            max-width: 500px;
        }

        .login-required h3 {
            color: #dc3545;
            margin-bottom: 1rem;
        }

        .login-required p {
            color: #666;
            margin-bottom: 1.5rem;
        }

        .login-button {
            background-color: #0066cc;
            color: white;
            text-decoration: none;
            padding: 1rem 2rem;
            border-radius: 4px;
            display: inline-block;
            transition: background-color 0.3s;
        }

        .login-button:hover {
            background-color: #0055b3;
        }

        .stats-panel {
            background-color: #e6f3ff;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .stat-item {
            background: white;
            padding: 1rem;
            border-radius: 4px;
            text-align: center;
        }

        .stat-item h4 {
            margin: 0 0 0.5rem 0;
            color: #0066cc;
        }

        .stat-item p {
            margin: 0;
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="and-logo.png" alt="Aquatic Nature Discovery Logo" class="logo">
            <h1>Aquatic Nature Discovery</h1>
        </div>
        <nav>
            <a href="index.html">Home</a>
            <a href="exhibits.html">Exhibits</a>
            <a href="conservation.html">Conservation</a>
            <a href="visit.html">Visit</a>
            <a href="support.html">Support Us</a>
            <a href="education.html">Education</a>
            <a href="events.html">Events</a>
            <a href="portal.html">Employee Portal</a>
        </nav>
    </header>

    <section id="hero">
        <h2>Maintenance Log</h2>
        <p>Track and manage aquarium maintenance activities and equipment repairs</p>
    </section>

    <div class="maintenance-container" id="maintenanceContent" style="display: none;">
        <div class="maintenance-header">
            <h2>Maintenance Log System</h2>
            <p>Record and track all maintenance activities, repairs, and scheduled inspections</p>
        </div>

        <div class="stats-panel">
            <h3>📊 Maintenance Overview</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <h4>Open Tasks</h4>
                    <p>8</p>
                </div>
                <div class="stat-item">
                    <h4>Completed Today</h4>
                    <p>3</p>
                </div>
                <div class="stat-item">
                    <h4>Urgent Items</h4>
                    <p>2</p>
                </div>
                <div class="stat-item">
                    <h4>Upcoming</h4>
                    <p>5</p>
                </div>
            </div>
        </div>

        <div class="maintenance-controls">
            <h3>➕ Add New Maintenance Entry</h3>
            <div class="control-group">
                <label for="maintenanceType">Type:</label>
                <select id="maintenanceType">
                    <option value="routine">Routine Maintenance</option>
                    <option value="repair">Equipment Repair</option>
                    <option value="inspection">Safety Inspection</option>
                    <option value="cleaning">Tank Cleaning</option>
                    <option value="emergency">Emergency Repair</option>
                </select>
            </div>
            <div class="control-group">
                <label for="maintenanceLocation">Location:</label>
                <select id="maintenanceLocation">
                    <option value="coral-reef">Coral Reef Tank</option>
                    <option value="deep-sea">Deep Sea Exhibit</option>
                    <option value="marine-mammals">Marine Mammals</option>
                    <option value="filtration">Filtration System</option>
                    <option value="electrical">Electrical Systems</option>
                    <option value="general">General Facility</option>
                </select>
            </div>
            <div class="control-group">
                <label for="maintenancePriority">Priority:</label>
                <select id="maintenancePriority">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                    <option value="urgent">Urgent</option>
                </select>
            </div>
            <div class="control-group">
                <label for="maintenanceDescription">Description:</label>
                <textarea id="maintenanceDescription" rows="3" placeholder="Describe the maintenance task..."></textarea>
            </div>
            <div class="control-group">
                <label for="maintenanceDate">Scheduled Date:</label>
                <input type="date" id="maintenanceDate">
            </div>
            <div class="control-group">
                <label for="maintenanceTime">Due Time:</label>
                <input type="time" id="maintenanceTime">
            </div>
            <div class="control-group">
                <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="reminderNotification" style="width: auto; margin: 0;">
                    🔔 Send browser notification when due
                </label>
                <button class="control-button" onclick="addMaintenanceEntry()">Add Entry</button>
            </div>
        </div>

        <div class="maintenance-grid" id="maintenanceGrid">
            <!-- Sample entries will be loaded here -->
        </div>
    </div>

    <div class="login-required" id="loginRequired">
        <h3>🔒 Access Restricted</h3>
        <p>This maintenance log requires employee authentication. Please log in to access maintenance tracking and management tools.</p>
        <a href="login.html" class="login-button">Employee Login</a>
    </div>

    <footer>
        <p>&copy; 2025 Aquatic Nature Discovery | A nonprofit organization</p>
    </footer>

    <script>
        // Check if user is logged in
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('employeeLoggedIn');
            
            if (isLoggedIn === 'true') {
                document.getElementById('maintenanceContent').style.display = 'block';
                document.getElementById('loginRequired').style.display = 'none';
                loadMaintenanceEntries();
            } else {
                document.getElementById('maintenanceContent').style.display = 'none';
                document.getElementById('loginRequired').style.display = 'block';
            }
        }

        // Load maintenance entries from localStorage
        function loadMaintenanceEntries() {
            const entries = JSON.parse(localStorage.getItem('maintenanceEntries') || '[]');
            const grid = document.getElementById('maintenanceGrid');
            
            if (entries.length === 0) {
                // Load sample data if no entries exist
                loadSampleData();
            } else {
                displayEntries(entries);
            }
        }

        // Load sample data for first-time users
        function loadSampleData() {
            const sampleEntries = [
                {
                    id: 1,
                    type: 'Emergency Repair',
                    location: 'Coral Reef Tank',
                    priority: 'urgent',
                    description: 'Temperature sensor malfunction',
                    assigned: 'John Smith',
                    due: 'Today',
                    dueTime: '14:30',
                    status: 'In Progress',
                    date: new Date().toISOString().split('T')[0],
                    reminderEnabled: true
                },
                {
                    id: 2,
                    type: 'Equipment Repair',
                    location: 'Filtration System',
                    priority: 'high',
                    description: 'Pump replacement needed',
                    assigned: 'Mike Johnson',
                    due: 'Tomorrow',
                    dueTime: '09:00',
                    status: 'Scheduled',
                    date: new Date(Date.now() + 86400000).toISOString().split('T')[0],
                    reminderEnabled: true
                },
                {
                    id: 3,
                    type: 'Routine Cleaning',
                    location: 'Deep Sea Exhibit',
                    priority: 'medium',
                    description: 'Glass cleaning and algae removal',
                    assigned: 'Sarah Wilson',
                    due: 'Today',
                    dueTime: '16:00',
                    status: 'Completed',
                    date: new Date().toISOString().split('T')[0],
                    reminderEnabled: false
                }
            ];
            
            localStorage.setItem('maintenanceEntries', JSON.stringify(sampleEntries));
            displayEntries(sampleEntries);
        }

        // Display maintenance entries
        function displayEntries(entries) {
            const grid = document.getElementById('maintenanceGrid');
            grid.innerHTML = '';
            
            entries.forEach(entry => {
                const card = createMaintenanceCard(entry);
                grid.appendChild(card);
            });
            
            updateStats(entries);
        }

        // Create a maintenance card element
        function createMaintenanceCard(entry) {
            const card = document.createElement('div');
            card.className = `maintenance-card priority-${entry.priority}`;
            
            const statusClass = entry.status === 'Completed' ? 'completed' : 
                              entry.status === 'In Progress' ? 'urgent' : 'pending';
            
            const icon = getTypeIcon(entry.type);
            
            card.innerHTML = `
                <h3>
                    <span class="status-indicator status-${statusClass}"></span>
                    ${icon} ${entry.type}
                </h3>
                <div class="maintenance-details">
                    <p><strong>Location:</strong> ${entry.location}</p>
                    <p><strong>Description:</strong> ${entry.description}</p>
                    <p><strong>Assigned:</strong> ${entry.assigned}</p>
                    <p><strong>Due:</strong> ${entry.due}${entry.dueTime && entry.dueTime !== 'No time specified' ? ` at ${entry.dueTime}` : ''}</p>
                    <p><strong>Status:</strong> ${entry.status}</p>
                    <p><strong>Date:</strong> ${entry.date}</p>
                    ${entry.reminderEnabled ? '<p><strong>🔔 Reminder:</strong> Enabled</p>' : ''}
                </div>
                <button class="control-button" onclick="deleteEntry(${entry.id})" style="margin-top: 1rem; background-color: #dc3545;">Delete</button>
            `;
            
            return card;
        }

        // Get icon for maintenance type
        function getTypeIcon(type) {
            const icons = {
                'Emergency Repair': '🚨',
                'Equipment Repair': '🔧',
                'Routine Cleaning': '🧹',
                'Safety Inspection': '🔍',
                'Electrical Work': '⚡',
                'Tank Maintenance': '🐠'
            };
            return icons[type] || '🔧';
        }

        // Update statistics
        function updateStats(entries) {
            const openTasks = entries.filter(e => e.status !== 'Completed').length;
            const completedToday = entries.filter(e => e.status === 'Completed' && e.date === new Date().toISOString().split('T')[0]).length;
            const urgentItems = entries.filter(e => e.priority === 'urgent' && e.status !== 'Completed').length;
            const upcoming = entries.filter(e => e.status === 'Scheduled').length;
            
            // Update stats display
            const statsItems = document.querySelectorAll('.stat-item p');
            if (statsItems.length >= 4) {
                statsItems[0].textContent = openTasks;
                statsItems[1].textContent = completedToday;
                statsItems[2].textContent = urgentItems;
                statsItems[3].textContent = upcoming;
            }
        }

        // Delete maintenance entry
        function deleteEntry(id) {
            if (confirm('Are you sure you want to delete this maintenance entry?')) {
                const entries = JSON.parse(localStorage.getItem('maintenanceEntries') || '[]');
                const filteredEntries = entries.filter(entry => entry.id !== id);
                localStorage.setItem('maintenanceEntries', JSON.stringify(filteredEntries));
                displayEntries(filteredEntries);
            }
        }

        // Add maintenance entry function
        function addMaintenanceEntry() {
            const type = document.getElementById('maintenanceType').value;
            const location = document.getElementById('maintenanceLocation').value;
            const priority = document.getElementById('maintenancePriority').value;
            const description = document.getElementById('maintenanceDescription').value;
            const date = document.getElementById('maintenanceDate').value;
            const time = document.getElementById('maintenanceTime').value;
            const reminderEnabled = document.getElementById('reminderNotification').checked;

            if (!description || !date) {
                alert('Please fill in all required fields.');
                return;
            }

            // Create new entry
            const newEntry = {
                id: Date.now(), // Use timestamp as unique ID
                type: getTypeDisplayName(type),
                location: getLocationDisplayName(location),
                priority: priority,
                description: description,
                assigned: 'Unassigned',
                due: getDueDate(date),
                dueTime: time || 'No time specified',
                status: 'Scheduled',
                date: date,
                reminderEnabled: reminderEnabled
            };

            // Get existing entries and add new one
            const entries = JSON.parse(localStorage.getItem('maintenanceEntries') || '[]');
            entries.push(newEntry);
            localStorage.setItem('maintenanceEntries', JSON.stringify(entries));

            // Refresh display
            displayEntries(entries);
            
            // Clear form
            document.getElementById('maintenanceDescription').value = '';
            document.getElementById('maintenanceDate').value = '';
            document.getElementById('maintenanceTime').value = '';
            document.getElementById('reminderNotification').checked = false;
            
            alert('Maintenance entry added successfully!');
        }

        // Helper functions for display names
        function getTypeDisplayName(type) {
            const displayNames = {
                'routine': 'Routine Maintenance',
                'repair': 'Equipment Repair',
                'inspection': 'Safety Inspection',
                'cleaning': 'Tank Cleaning',
                'emergency': 'Emergency Repair'
            };
            return displayNames[type] || type;
        }

        function getLocationDisplayName(location) {
            const displayNames = {
                'coral-reef': 'Coral Reef Tank',
                'deep-sea': 'Deep Sea Exhibit',
                'marine-mammals': 'Marine Mammals',
                'filtration': 'Filtration System',
                'electrical': 'Electrical Systems',
                'general': 'General Facility'
            };
            return displayNames[location] || location;
        }

        function getDueDate(date) {
            const today = new Date();
            const entryDate = new Date(date);
            const diffTime = entryDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Tomorrow';
            if (diffDays < 0) return 'Overdue';
            if (diffDays <= 7) return 'This Week';
            return 'Next Week';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            // Set default date to today
            document.getElementById('maintenanceDate').value = new Date().toISOString().split('T')[0];
            
            // Start reminder checker (permission will be requested when needed)
            startReminderChecker();
            
            // Add event listener for reminder checkbox
            document.getElementById('reminderNotification').addEventListener('change', function() {
                if (this.checked) {
                    requestNotificationPermission();
                }
            });
        });

        // Auto-refresh login status every 30 seconds
        setInterval(checkLoginStatus, 30000);

        // Notification functions
        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(function(permission) {
                    if (permission === 'granted') {
                        console.log('Notification permission granted');
                    } else if (permission === 'denied') {
                        console.log('Notification permission denied');
                        // Uncheck the checkbox if permission is denied
                        document.getElementById('reminderNotification').checked = false;
                        alert('Notification permission denied. Reminders will not work without permission.');
                    }
                });
            } else {
                alert('Browser notifications are not supported in this browser.');
                document.getElementById('reminderNotification').checked = false;
            }
        }

        function startReminderChecker() {
            // Check for due reminders every minute
            setInterval(checkDueReminders, 60000);
        }

        function checkDueReminders() {
            const entries = JSON.parse(localStorage.getItem('maintenanceEntries') || '[]');
            const now = new Date();
            const currentTime = now.toTimeString().slice(0, 5); // HH:MM format
            const currentDate = now.toISOString().split('T')[0];

            entries.forEach(entry => {
                if (entry.reminderEnabled && entry.status !== 'Completed') {
                    const dueDate = entry.date;
                    const dueTime = entry.dueTime;
                    
                    // Check if it's due today and the time matches (within 1 minute)
                    if (dueDate === currentDate && dueTime && dueTime !== 'No time specified') {
                        const [dueHour, dueMinute] = dueTime.split(':').map(Number);
                        const [currentHour, currentMinute] = currentTime.split(':').map(Number);
                        
                        const dueMinutes = dueHour * 60 + dueMinute;
                        const currentMinutes = currentHour * 60 + currentMinute;
                        
                        // Show notification if due within the next minute
                        if (Math.abs(dueMinutes - currentMinutes) <= 1) {
                            showMaintenanceReminder(entry);
                        }
                    }
                }
            });
        }

        function showMaintenanceReminder(entry) {
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = new Notification('Maintenance Due', {
                    body: `${entry.type} at ${entry.location} is due now. ${entry.description}`,
                    icon: 'and-logo.png',
                    tag: `maintenance-${entry.id}`, // Prevents duplicate notifications
                    requireInteraction: true
                });

                notification.onclick = function() {
                    window.focus();
                    notification.close();
                };
            }
        }
    </script>
</body>
</html> 